!function(root,undefined){function isString(obj){return!!(""===obj||obj&&obj.charCodeAt&&obj.substr)}function isArray(obj){return nativeIsArray?nativeIsArray(obj):"[object Array]"===toString.call(obj)}function isObject(obj){return obj&&"[object Object]"===toString.call(obj)}function defaults(object,defs){var key;object=object||{},defs=defs||{};for(key in defs)defs.hasOwnProperty(key)&&null==object[key]&&(object[key]=defs[key]);return object}function map(obj,iterator,context){var i,j,results=[];if(!obj)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);for(i=0,j=obj.length;j>i;i++)results[i]=iterator.call(context,obj[i],i,obj);return results}function checkPrecision(val,base){return val=Math.round(Math.abs(val)),isNaN(val)?base:val}function checkCurrencyFormat(format){var defaults=lib.settings.currency.format;return"function"==typeof format&&(format=format()),isString(format)&&format.match("%v")?{pos:format,neg:format.replace("-","").replace("%v","-%v"),zero:format}:format&&format.pos&&format.pos.match("%v")?format:isString(defaults)?lib.settings.currency.format={pos:defaults,neg:defaults.replace("%v","-%v"),zero:defaults}:defaults}var lib={};lib.version="0.4.1",lib.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var nativeMap=Array.prototype.map,nativeIsArray=Array.isArray,toString=Object.prototype.toString,unformat=lib.unformat=lib.parse=function(value,decimal){if(isArray(value))return map(value,function(val){return unformat(val,decimal)});if(value=value||0,"number"==typeof value)return value;decimal=decimal||lib.settings.number.decimal;var regex=new RegExp("[^0-9-"+decimal+"]",["g"]),unformatted=parseFloat((""+value).replace(/\((.*)\)/,"-$1").replace(regex,"").replace(decimal,"."));return isNaN(unformatted)?0:unformatted},toFixed=lib.toFixed=function(value,precision){precision=checkPrecision(precision,lib.settings.number.precision);var power=Math.pow(10,precision);return(Math.round(lib.unformat(value)*power)/power).toFixed(precision)},formatNumber=lib.formatNumber=lib.format=function(number,precision,thousand,decimal){if(isArray(number))return map(number,function(val){return formatNumber(val,precision,thousand,decimal)});number=unformat(number);var opts=defaults(isObject(precision)?precision:{precision:precision,thousand:thousand,decimal:decimal},lib.settings.number),usePrecision=checkPrecision(opts.precision),negative=0>number?"-":"",base=parseInt(toFixed(Math.abs(number||0),usePrecision),10)+"",mod=base.length>3?base.length%3:0;return negative+(mod?base.substr(0,mod)+opts.thousand:"")+base.substr(mod).replace(/(\d{3})(?=\d)/g,"$1"+opts.thousand)+(usePrecision?opts.decimal+toFixed(Math.abs(number),usePrecision).split(".")[1]:"")},formatMoney=lib.formatMoney=function(number,symbol,precision,thousand,decimal,format){if(isArray(number))return map(number,function(val){return formatMoney(val,symbol,precision,thousand,decimal,format)});number=unformat(number);var opts=defaults(isObject(symbol)?symbol:{symbol:symbol,precision:precision,thousand:thousand,decimal:decimal,format:format},lib.settings.currency),formats=checkCurrencyFormat(opts.format),useFormat=number>0?formats.pos:0>number?formats.neg:formats.zero;return useFormat.replace("%s",opts.symbol).replace("%v",formatNumber(Math.abs(number),checkPrecision(opts.precision),opts.thousand,opts.decimal))};lib.formatColumn=function(list,symbol,precision,thousand,decimal,format){if(!list)return[];var opts=defaults(isObject(symbol)?symbol:{symbol:symbol,precision:precision,thousand:thousand,decimal:decimal,format:format},lib.settings.currency),formats=checkCurrencyFormat(opts.format),padAfterSymbol=formats.pos.indexOf("%s")<formats.pos.indexOf("%v")?!0:!1,maxLength=0,formatted=map(list,function(val){if(isArray(val))return lib.formatColumn(val,opts);val=unformat(val);var useFormat=val>0?formats.pos:0>val?formats.neg:formats.zero,fVal=useFormat.replace("%s",opts.symbol).replace("%v",formatNumber(Math.abs(val),checkPrecision(opts.precision),opts.thousand,opts.decimal));return fVal.length>maxLength&&(maxLength=fVal.length),fVal});return map(formatted,function(val){return isString(val)&&val.length<maxLength?padAfterSymbol?val.replace(opts.symbol,opts.symbol+new Array(maxLength-val.length+1).join(" ")):new Array(maxLength-val.length+1).join(" ")+val:val})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=lib),exports.accounting=lib):"function"==typeof define&&define.amd?define([],function(){return lib}):(lib.noConflict=function(oldAccounting){return function(){return root.accounting=oldAccounting,lib.noConflict=undefined,lib}}(root.accounting),root.accounting=lib)}(this);