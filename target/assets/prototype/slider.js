if(!Control)var Control={};Control.Slider=Class.create({initialize:function(handle,track,options){var slider=this;this.handles=Object.isArray(handle)?handle.collect(function(e){return $(e)}):[$(handle)],this.track=$(track),this.options=options||{},this.axis=this.options.axis||"horizontal",this.increment=this.options.increment||1,this.step=parseInt(this.options.step||"1"),this.range=this.options.range||$R(0,1),this.value=0,this.values=this.handles.map(function(){return 0}),this.spans=this.options.spans?this.options.spans.map(function(s){return $(s)}):!1,this.options.startSpan=$(this.options.startSpan||null),this.options.endSpan=$(this.options.endSpan||null),this.restricted=this.options.restricted||!1,this.maximum=this.options.maximum||this.range.end,this.minimum=this.options.minimum||this.range.start,this.alignX=parseInt(this.options.alignX||"0"),this.alignY=parseInt(this.options.alignY||"0"),this.trackLength=this.maximumOffset()-this.minimumOffset(),this.handleLength=this.isVertical()?0!=this.handles[0].offsetHeight?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,""):0!=this.handles[0].offsetWidth?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""),this.active=!1,this.dragging=!1,this.disabled=!1,this.options.disabled&&this.setDisabled(),this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):!1,this.allowedValues&&(this.minimum=this.allowedValues.min(),this.maximum=this.allowedValues.max()),this.eventMouseDown=this.startDrag.bindAsEventListener(this),this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.update.bindAsEventListener(this),this.handles.each(function(h,i){i=slider.handles.length-1-i,slider.setValue(parseFloat((Object.isArray(slider.options.sliderValue)?slider.options.sliderValue[i]:slider.options.sliderValue)||slider.range.start),i),h.makePositioned().observe("mousedown",slider.eventMouseDown)}),this.track.observe("mousedown",this.eventMouseDown),document.observe("mouseup",this.eventMouseUp),document.observe("mousemove",this.eventMouseMove),this.initialized=!0},dispose:function(){var slider=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown),Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),this.handles.each(function(h){Event.stopObserving(h,"mousedown",slider.eventMouseDown)})},setDisabled:function(){this.disabled=!0},setEnabled:function(){this.disabled=!1},getNearestValue:function(value){if(this.allowedValues){if(value>=this.allowedValues.max())return this.allowedValues.max();if(value<=this.allowedValues.min())return this.allowedValues.min();var offset=Math.abs(this.allowedValues[0]-value),newValue=this.allowedValues[0];return this.allowedValues.each(function(v){var currentOffset=Math.abs(v-value);offset>=currentOffset&&(newValue=v,offset=currentOffset)}),newValue}return value>this.range.end?this.range.end:value<this.range.start?this.range.start:value},setValue:function(sliderValue,handleIdx){this.active||(this.activeHandleIdx=handleIdx||0,this.activeHandle=this.handles[this.activeHandleIdx],this.updateStyles()),handleIdx=handleIdx||this.activeHandleIdx||0,this.initialized&&this.restricted&&(handleIdx>0&&sliderValue<this.values[handleIdx-1]&&(sliderValue=this.values[handleIdx-1]),handleIdx<this.handles.length-1&&sliderValue>this.values[handleIdx+1]&&(sliderValue=this.values[handleIdx+1])),sliderValue=this.getNearestValue(sliderValue),this.values[handleIdx]=sliderValue,this.value=this.values[0],this.handles[handleIdx].style[this.isVertical()?"top":"left"]=this.translateToPx(sliderValue),this.drawSpans(),this.dragging&&this.event||this.updateFinished()},setValueBy:function(delta,handleIdx){this.setValue(this.values[handleIdx||this.activeHandleIdx||0]+delta,handleIdx||this.activeHandleIdx||0)},translateToPx:function(value){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(value-this.range.start))+"px"},translateToValue:function(offset){return offset/(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(range){var v=this.values.sortBy(Prototype.K);return range=range||0,$R(v[range],v[range+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(0!=this.track.offsetHeight?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(0!=this.track.offsetWidth?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX},isVertical:function(){return"vertical"==this.axis},drawSpans:function(){var slider=this;this.spans&&$R(0,this.spans.length-1).each(function(r){slider.setSpan(slider.spans[r],slider.getRange(r))}),this.options.startSpan&&this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value)),this.options.endSpan&&this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(span,range){this.isVertical()?(span.style.top=this.translateToPx(range.start),span.style.height=this.translateToPx(range.end-range.start+this.range.start)):(span.style.left=this.translateToPx(range.start),span.style.width=this.translateToPx(range.end-range.start+this.range.start))},updateStyles:function(){this.handles.each(function(h){Element.removeClassName(h,"selected")}),Element.addClassName(this.activeHandle,"selected")},startDrag:function(event){if(Event.isLeftClick(event)){if(!this.disabled){this.active=!0;var handle=Event.element(event),pointer=[Event.pointerX(event),Event.pointerY(event)],track=handle;if(track==this.track){var offsets=this.track.cumulativeOffset();this.event=event,this.setValue(this.translateToValue((this.isVertical()?pointer[1]-offsets[1]:pointer[0]-offsets[0])-this.handleLength/2));var offsets=this.activeHandle.cumulativeOffset();this.offsetX=pointer[0]-offsets[0],this.offsetY=pointer[1]-offsets[1]}else{for(;-1==this.handles.indexOf(handle)&&handle.parentNode;)handle=handle.parentNode;if(-1!=this.handles.indexOf(handle)){this.activeHandle=handle,this.activeHandleIdx=this.handles.indexOf(this.activeHandle),this.updateStyles();var offsets=this.activeHandle.cumulativeOffset();this.offsetX=pointer[0]-offsets[0],this.offsetY=pointer[1]-offsets[1]}}}Event.stop(event)}},update:function(event){this.active&&(this.dragging||(this.dragging=!0),this.draw(event),Prototype.Browser.WebKit&&window.scrollBy(0,0),Event.stop(event))},draw:function(event){var pointer=[Event.pointerX(event),Event.pointerY(event)],offsets=this.track.cumulativeOffset();pointer[0]-=this.offsetX+offsets[0],pointer[1]-=this.offsetY+offsets[1],this.event=event,this.setValue(this.translateToValue(this.isVertical()?pointer[1]:pointer[0])),this.initialized&&this.options.onSlide&&this.options.onSlide(this.values.length>1?this.values:this.value,this)},endDrag:function(event){this.active&&this.dragging&&(this.finishDrag(event,!0),Event.stop(event)),this.active=!1,this.dragging=!1},finishDrag:function(){this.active=!1,this.dragging=!1,this.updateFinished()},updateFinished:function(){this.initialized&&this.options.onChange&&this.options.onChange(this.values.length>1?this.values:this.value,this),this.event=null}});