var Rico={Version:"1.1-beta2"};Rico.ArrayExtensions=new Array,Object.prototype.extend&&(Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Object.prototype.extend),Array.prototype.push&&(Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.push),Array.prototype.remove||(Array.prototype.remove=function(dx){if(isNaN(dx)||dx>this.length)return!1;for(var i=0,n=0;i<this.length;i++)i!=dx&&(this[n++]=this[i]);this.length-=1},Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.remove),Array.prototype.removeItem||(Array.prototype.removeItem=function(item){for(var i=0;i<this.length;i++)if(this[i]==item){this.remove(i);break}},Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.removeItem),Array.prototype.indices||(Array.prototype.indices=function(){var indexArray=new Array;for(index in this){for(var ignoreThis=!1,i=0;i<Rico.ArrayExtensions.length;i++)if(this[index]==Rico.ArrayExtensions[i]){ignoreThis=!0;break}ignoreThis||(indexArray[indexArray.length]=index)}return indexArray},Rico.ArrayExtensions[Rico.ArrayExtensions.length]=Array.prototype.indices),window.DOMParser&&window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__&&(Document.prototype.loadXML||(Document.prototype.loadXML=function(s){for(var doc2=(new DOMParser).parseFromString(s,"text/xml");this.hasChildNodes();)this.removeChild(this.lastChild);for(var i=0;i<doc2.childNodes.length;i++)this.appendChild(this.importNode(doc2.childNodes[i],!0))}),Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)})),document.getElementsByTagAndClassName=function(tagName,className){null==tagName&&(tagName="*");var children=document.getElementsByTagName(tagName)||document.all,elements=new Array;if(null==className)return children;for(var i=0;i<children.length;i++)for(var child=children[i],classNames=child.className.split(" "),j=0;j<classNames.length;j++)if(classNames[j]==className){elements.push(child);break}return elements},Rico.Accordion=Class.create(),Rico.Accordion.prototype={initialize:function(container,options){this.container=$(container),this.lastExpandedTab=null,this.accordionTabs=new Array,this.setOptions(options),this._attachBehaviors(),this.container.style.borderBottom="1px solid "+this.options.borderColor;for(var i=1;i<this.accordionTabs.length;i++)this.accordionTabs[i].collapse(),this.accordionTabs[i].content.style.display="none";this.lastExpandedTab=this.accordionTabs[0],this.lastExpandedTab.content.style.height=this.options.panelHeight+"px",this.lastExpandedTab.showExpanded(),this.lastExpandedTab.titleBar.style.fontWeight=this.options.expandedFontWeight},setOptions:function(options){this.options={expandedBg:"#63699c",hoverBg:"#63699c",collapsedBg:"#6b79a5",expandedTextColor:"#ffffff",expandedFontWeight:"bold",hoverTextColor:"#ffffff",collapsedTextColor:"#ced7ef",collapsedFontWeight:"normal",hoverTextColor:"#ffffff",borderColor:"#1f669b",panelHeight:200,onHideTab:null,onShowTab:null}.extend(options||{})},showTabByIndex:function(anIndex,animate){var doAnimate=1==arguments.length?!0:animate;this.showTab(this.accordionTabs[anIndex],doAnimate)},showTab:function(accordionTab,animate){var doAnimate=1==arguments.length?!0:animate;this.options.onHideTab&&this.options.onHideTab(this.lastExpandedTab),this.lastExpandedTab.showCollapsed();var accordion=this,lastExpandedTab=this.lastExpandedTab;this.lastExpandedTab.content.style.height=this.options.panelHeight-1+"px",accordionTab.content.style.display="",accordionTab.titleBar.style.fontWeight=this.options.expandedFontWeight,doAnimate?(new Effect.AccordionSize(this.lastExpandedTab.content,accordionTab.content,1,this.options.panelHeight,100,10,{complete:function(){accordion.showTabDone(lastExpandedTab)}}),this.lastExpandedTab=accordionTab):(this.lastExpandedTab.content.style.height="1px",accordionTab.content.style.height=this.options.panelHeight+"px",this.lastExpandedTab=accordionTab,this.showTabDone(lastExpandedTab))},showTabDone:function(collapsedTab){collapsedTab.content.style.display="none",this.lastExpandedTab.showExpanded(),this.options.onShowTab&&this.options.onShowTab(this.lastExpandedTab)},_attachBehaviors:function(){for(var panels=this._getDirectChildrenByTag(this.container,"DIV"),i=0;i<panels.length;i++){var tabChildren=this._getDirectChildrenByTag(panels[i],"DIV");if(2==tabChildren.length){var tabTitleBar=tabChildren[0],tabContentBox=tabChildren[1];this.accordionTabs.push(new Rico.Accordion.Tab(this,tabTitleBar,tabContentBox))}}},_getDirectChildrenByTag:function(e,tagName){for(var kids=new Array,allKids=e.childNodes,i=0;i<allKids.length;i++)allKids[i]&&allKids[i].tagName&&allKids[i].tagName==tagName&&kids.push(allKids[i]);return kids}},Rico.Accordion.Tab=Class.create(),Rico.Accordion.Tab.prototype={initialize:function(accordion,titleBar,content){this.accordion=accordion,this.titleBar=titleBar,this.content=content,this._attachBehaviors()},collapse:function(){this.showCollapsed(),this.content.style.height="1px"},showCollapsed:function(){this.expanded=!1,this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg,this.titleBar.style.color=this.accordion.options.collapsedTextColor,this.titleBar.style.fontWeight=this.accordion.options.collapsedFontWeight,this.content.style.overflow="hidden"},showExpanded:function(){this.expanded=!0,this.titleBar.style.backgroundColor=this.accordion.options.expandedBg,this.titleBar.style.color=this.accordion.options.expandedTextColor,this.content.style.overflow="visible"},titleBarClicked:function(){this.accordion.lastExpandedTab!=this&&this.accordion.showTab(this)},hover:function(){this.titleBar.style.backgroundColor=this.accordion.options.hoverBg,this.titleBar.style.color=this.accordion.options.hoverTextColor},unhover:function(){this.expanded?(this.titleBar.style.backgroundColor=this.accordion.options.expandedBg,this.titleBar.style.color=this.accordion.options.expandedTextColor):(this.titleBar.style.backgroundColor=this.accordion.options.collapsedBg,this.titleBar.style.color=this.accordion.options.collapsedTextColor)},_attachBehaviors:function(){this.content.style.border="1px solid "+this.accordion.options.borderColor,this.content.style.borderTopWidth="0px",this.content.style.borderBottomWidth="0px",this.content.style.margin="0px",this.titleBar.onclick=this.titleBarClicked.bindAsEventListener(this),this.titleBar.onmouseover=this.hover.bindAsEventListener(this),this.titleBar.onmouseout=this.unhover.bindAsEventListener(this)}},Rico.AjaxEngine=Class.create(),Rico.AjaxEngine.prototype={initialize:function(){this.ajaxElements=new Array,this.ajaxObjects=new Array,this.requestURLS=new Array},registerAjaxElement:function(anId,anElement){1==arguments.length&&(anElement=$(anId)),this.ajaxElements[anId]=anElement},registerAjaxObject:function(anId,anObject){this.ajaxObjects[anId]=anObject},registerRequest:function(requestLogicalName,requestURL){this.requestURLS[requestLogicalName]=requestURL},sendRequest:function(requestName){var requestURL=this.requestURLS[requestName];if(null!=requestURL){var queryString="";arguments.length>1&&(queryString="object"==typeof arguments[1]&&void 0!=arguments[1].length?this._createQueryString(arguments[1],0):this._createQueryString(arguments,1)),new Ajax.Request(requestURL,this._requestOptions(queryString))}},sendRequestWithData:function(requestName,xmlDocument){var requestURL=this.requestURLS[requestName];if(null!=requestURL){var queryString="";arguments.length>2&&(queryString="object"==typeof arguments[2]&&void 0!=arguments[2].length?this._createQueryString(arguments[2],0):this._createQueryString(arguments,2)),new Ajax.Request(requestURL+"?"+queryString,this._requestOptions(null,xmlDocument))}},sendRequestAndUpdate:function(requestName,container,options){var requestURL=this.requestURLS[requestName];if(null!=requestURL){var queryString="";arguments.length>3&&(queryString="object"==typeof arguments[3]&&void 0!=arguments[3].length?this._createQueryString(arguments[3],0):this._createQueryString(arguments,3));var updaterOptions=this._requestOptions(queryString);updaterOptions.onComplete=null,updaterOptions.extend(options),new Ajax.Updater(container,requestURL,updaterOptions)}},sendRequestWithDataAndUpdate:function(requestName,xmlDocument,container,options){var requestURL=this.requestURLS[requestName];if(null!=requestURL){var queryString="";arguments.length>4&&(queryString="object"==typeof arguments[4]&&void 0!=arguments[4].length?this._createQueryString(arguments[4],0):this._createQueryString(arguments,4));var updaterOptions=this._requestOptions(queryString,xmlDocument);updaterOptions.onComplete=null,updaterOptions.extend(options),new Ajax.Updater(container,requestURL+"?"+queryString,updaterOptions)}},_requestOptions:function(queryString,xmlDoc){var self=this,requestHeaders=["X-Rico-Version",Rico.Version],sendMethod="post";return arguments[1]?requestHeaders.push("Content-type","text/xml"):sendMethod="get",{requestHeaders:requestHeaders,parameters:queryString,postBody:arguments[1]?xmlDoc:null,method:sendMethod,onComplete:self._onRequestComplete.bind(self)}},_createQueryString:function(theArgs,offset){for(var queryString="",i=offset;i<theArgs.length;i++){i!=offset&&(queryString+="&");var anArg=theArgs[i];if(void 0!=anArg.name&&void 0!=anArg.value)queryString+=anArg.name+"="+escape(anArg.value);else{var ePos=anArg.indexOf("="),argName=anArg.substring(0,ePos),argValue=anArg.substring(ePos+1);queryString+=argName+"="+escape(argValue)}}return queryString},_onRequestComplete:function(request){if(200==request.status){var response=request.responseXML.getElementsByTagName("ajax-response");null!=response&&1==response.length&&this._processAjaxResponse(response[0].childNodes)}},_processAjaxResponse:function(xmlResponseElements){for(var i=0;i<xmlResponseElements.length;i++){var responseElement=xmlResponseElements[i];if(1==responseElement.nodeType){var responseType=responseElement.getAttribute("type"),responseId=responseElement.getAttribute("id");"object"==responseType?this._processAjaxObjectUpdate(this.ajaxObjects[responseId],responseElement):"element"==responseType?this._processAjaxElementUpdate(this.ajaxElements[responseId],responseElement):alert("unrecognized AjaxResponse type : "+responseType)}}},_processAjaxObjectUpdate:function(ajaxObject,responseElement){ajaxObject.ajaxUpdate(responseElement)},_processAjaxElementUpdate:function(ajaxElement,responseElement){ajaxElement.innerHTML=RicoUtil.getContentAsString(responseElement)}};var ajaxEngine=new Rico.AjaxEngine;Rico.Color=Class.create(),Rico.Color.prototype={initialize:function(red,green,blue){this.rgb={r:red,g:green,b:blue}},setRed:function(r){this.rgb.r=r},setGreen:function(g){this.rgb.g=g},setBlue:function(b){this.rgb.b=b},setHue:function(h){var hsb=this.asHSB();hsb.h=h,this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setSaturation:function(s){var hsb=this.asHSB();hsb.s=s,this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setBrightness:function(b){var hsb=this.asHSB();hsb.b=b,this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},darken:function(percent){var hsb=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.max(hsb.b-percent,0))},brighten:function(percent){var hsb=this.asHSB();this.rgb=Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.min(hsb.b+percent,1))},blend:function(other){this.rgb.r=Math.floor((this.rgb.r+other.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+other.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+other.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}},Rico.Color.createFromHex=function(hexCode){0==hexCode.indexOf("#")&&(hexCode=hexCode.substring(1));var red=hexCode.substring(0,2),green=hexCode.substring(2,4),blue=hexCode.substring(4,6);return new Rico.Color(parseInt(red,16),parseInt(green,16),parseInt(blue,16))},Rico.Color.createColorFromBackground=function(elem){var actualColor=RicoUtil.getElementsComputedStyle($(elem),"backgroundColor","background-color");if("transparent"==actualColor&&elem.parent)return Rico.Color.createColorFromBackground(elem.parent);if(null==actualColor)return new Rico.Color(255,255,255);if(0==actualColor.indexOf("rgb(")){var colors=actualColor.substring(4,actualColor.length-1),colorArray=colors.split(",");return new Rico.Color(parseInt(colorArray[0]),parseInt(colorArray[1]),parseInt(colorArray[2]))}if(0==actualColor.indexOf("#")){var redPart=parseInt(actualColor.substring(1,3),16),greenPart=parseInt(actualColor.substring(3,5),16),bluePart=parseInt(actualColor.substring(5),16);return new Rico.Color(redPart,greenPart,bluePart)}return new Rico.Color(255,255,255)},Rico.Color.HSBtoRGB=function(hue,saturation,brightness){var red=0,green=0,blue=0;if(0==saturation)red=parseInt(255*brightness+.5),green=red,blue=red;else{var h=6*(hue-Math.floor(hue)),f=h-Math.floor(h),p=brightness*(1-saturation),q=brightness*(1-saturation*f),t=brightness*(1-saturation*(1-f));switch(parseInt(h)){case 0:red=255*brightness+.5,green=255*t+.5,blue=255*p+.5;break;case 1:red=255*q+.5,green=255*brightness+.5,blue=255*p+.5;break;case 2:red=255*p+.5,green=255*brightness+.5,blue=255*t+.5;break;case 3:red=255*p+.5,green=255*q+.5,blue=255*brightness+.5;break;case 4:red=255*t+.5,green=255*p+.5,blue=255*brightness+.5;break;case 5:red=255*brightness+.5,green=255*p+.5,blue=255*q+.5}}return{r:parseInt(red),g:parseInt(green),b:parseInt(blue)}},Rico.Color.RGBtoHSB=function(r,g,b){var hue,brightness,cmax=r>g?r:g;b>cmax&&(cmax=b);var cmin=g>r?r:g;if(cmin>b&&(cmin=b),brightness=cmax/255,saturation=0!=cmax?(cmax-cmin)/cmax:0,0==saturation)hue=0;else{var redc=(cmax-r)/(cmax-cmin),greenc=(cmax-g)/(cmax-cmin),bluec=(cmax-b)/(cmax-cmin);hue=r==cmax?bluec-greenc:g==cmax?2+redc-bluec:4+greenc-redc,hue/=6,0>hue&&(hue+=1)}return{h:hue,s:saturation,b:brightness}},Rico.Corner={round:function(e,options){var e=$(e);this._setOptions(options);var color=this.options.color;"fromElement"==this.options.color&&(color=this._background(e));var bgColor=this.options.bgColor;"fromParent"==this.options.bgColor&&(bgColor=this._background(e.offsetParent)),this._roundCornersImpl(e,color,bgColor)},_roundCornersImpl:function(e,color,bgColor){this.options.border&&this._renderBorder(e,bgColor),this._isTopRounded()&&this._roundTopCorners(e,color,bgColor),this._isBottomRounded()&&this._roundBottomCorners(e,color,bgColor)},_renderBorder:function(el,bgColor){var borderValue="1px solid "+this._borderColor(bgColor),borderL="border-left: "+borderValue,borderR="border-right: "+borderValue,style="style='"+borderL+";"+borderR+"'";el.innerHTML="<div "+style+">"+el.innerHTML+"</div>"},_roundTopCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=0;i<this.options.numSlices;i++)corner.appendChild(this._createCornerSlice(color,bgColor,i,"top"));el.style.paddingTop=0,el.insertBefore(corner,el.firstChild)},_roundBottomCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=this.options.numSlices-1;i>=0;i--)corner.appendChild(this._createCornerSlice(color,bgColor,i,"bottom"));el.style.paddingBottom=0,el.appendChild(corner)},_createCorner:function(bgColor){var corner=document.createElement("div");return corner.style.backgroundColor=this._isTransparent()?"transparent":bgColor,corner},_createCornerSlice:function(color,bgColor,n,position){var slice=document.createElement("span"),inStyle=slice.style;inStyle.backgroundColor=color,inStyle.display="block",inStyle.height="1px",inStyle.overflow="hidden",inStyle.fontSize="1px";var borderColor=this._borderColor(color,bgColor);return this.options.border&&0==n?(inStyle.borderTopStyle="solid",inStyle.borderTopWidth="1px",inStyle.borderLeftWidth="0px",inStyle.borderRightWidth="0px",inStyle.borderBottomWidth="0px",inStyle.height="0px",inStyle.borderColor=borderColor):borderColor&&(inStyle.borderColor=borderColor,inStyle.borderStyle="solid",inStyle.borderWidth="0px 1px"),this.options.compact||n!=this.options.numSlices-1||(inStyle.height="2px"),this._setMargin(slice,n,position),this._setBorder(slice,n,position),slice},_setOptions:function(options){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1}.extend(options||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(color,bgColor){return"transparent"==color?bgColor:this.options.border?this.options.border:this.options.blend?this._blend(bgColor,color):""},_setMargin:function(el,n,corners){var marginSize=this._marginSize(n),whichSide="top"==corners?this._whichSideTop():this._whichSideBottom();"left"==whichSide?(el.style.marginLeft=marginSize+"px",el.style.marginRight="0px"):"right"==whichSide?(el.style.marginRight=marginSize+"px",el.style.marginLeft="0px"):(el.style.marginLeft=marginSize+"px",el.style.marginRight=marginSize+"px")},_setBorder:function(el,n,corners){var borderSize=this._borderSize(n),whichSide="top"==corners?this._whichSideTop():this._whichSideBottom();"left"==whichSide?(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth="0px"):"right"==whichSide?(el.style.borderRightWidth=borderSize+"px",el.style.borderLeftWidth="0px"):(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth=borderSize+"px")},_marginSize:function(n){if(this._isTransparent())return 0;var marginSizes=[5,3,2,1],blendedMarginSizes=[3,2,1,0],compactMarginSizes=[2,1],smBlendedMarginSizes=[1,0];return this.options.compact&&this.options.blend?smBlendedMarginSizes[n]:this.options.compact?compactMarginSizes[n]:this.options.blend?blendedMarginSizes[n]:marginSizes[n]},_borderSize:function(n){var transparentBorderSizes=[5,3,2,1],blendedBorderSizes=[2,1,1,1],compactBorderSizes=[1,0],actualBorderSizes=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?compactBorderSizes[n]:this.options.blend?blendedBorderSizes[n]:this.options.border?actualBorderSizes[n]:this._isTransparent()?transparentBorderSizes[n]:0},_hasString:function(str){for(var i=1;i<arguments.length;i++)if(str.indexOf(arguments[i])>=0)return!0;return!1},_blend:function(c1,c2){var cc1=Rico.Color.createFromHex(c1);return cc1.blend(Rico.Color.createFromHex(c2)),cc1},_background:function(el){try{return Rico.Color.createColorFromBackground(el).asHex()}catch(err){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(el){return 1==el.childNodes.length&&3==el.childNodes[0].nodeType}},Rico.DragAndDrop=Class.create(),Rico.DragAndDrop.prototype={initialize:function(){this.dropZones=new Array,this.draggables=new Array,this.currentDragObjects=new Array,this.dragElement=null,this.lastSelectedDraggable=null,this.currentDragObjectVisible=!1,this.interestedInMotionEvents=!1},registerDropZone:function(aDropZone){this.dropZones[this.dropZones.length]=aDropZone},deregisterDropZone:function(aDropZone){for(var newDropZones=new Array,j=0,i=0;i<this.dropZones.length;i++)this.dropZones[i]!=aDropZone&&(newDropZones[j++]=this.dropZones[i]);this.dropZones=newDropZones},clearDropZones:function(){this.dropZones=new Array},registerDraggable:function(aDraggable){this.draggables[this.draggables.length]=aDraggable,this._addMouseDownHandler(aDraggable)},clearSelection:function(){for(var i=0;i<this.currentDragObjects.length;i++)this.currentDragObjects[i].deselect();this.currentDragObjects=new Array,this.lastSelectedDraggable=null},hasSelection:function(){return this.currentDragObjects.length>0},setStartDragFromElement:function(e,mouseDownElement){this.origPos=RicoUtil.toDocumentPosition(mouseDownElement),this.startx=e.screenX-this.origPos.x,this.starty=e.screenY-this.origPos.y,this.interestedInMotionEvents=this.hasSelection(),this._terminateEvent(e)},updateSelection:function(draggable,extendSelection){extendSelection||this.clearSelection(),draggable.isSelected()?(this.currentDragObjects.removeItem(draggable),draggable.deselect(),draggable==this.lastSelectedDraggable&&(this.lastSelectedDraggable=null)):(this.currentDragObjects[this.currentDragObjects.length]=draggable,draggable.select(),this.lastSelectedDraggable=draggable)},_mouseDownHandler:function(e){0==arguments.length&&(e=event);var nsEvent=void 0!=e.which;if(!(nsEvent&&1!=e.which||!nsEvent&&1!=e.button)){for(var eventTarget=e.target?e.target:e.srcElement,draggableObject=eventTarget.draggable,candidate=eventTarget;null==draggableObject&&candidate.parentNode;)candidate=candidate.parentNode,draggableObject=candidate.draggable;if(null!=draggableObject){if(this.updateSelection(draggableObject,e.ctrlKey),this.hasSelection())for(var i=0;i<this.dropZones.length;i++)this.dropZones[i].clearPositionCache();this.setStartDragFromElement(e,draggableObject.getMouseDownHTMLElement())}}},_mouseMoveHandler:function(e){void 0!=e.which;return this.interestedInMotionEvents?void(this.hasSelection()&&(this.currentDragObjectVisible||this._startDrag(e),this.activatedDropZones||this._activateRegisteredDropZones(),this._updateDraggableLocation(e),this._updateDropZonesHover(e),this._terminateEvent(e))):void this._terminateEvent(e)},_makeDraggableObjectVisible:function(e){if(this.hasSelection()){var dragElement;dragElement=this.currentDragObjects.length>1?this.currentDragObjects[0].getMultiObjectDragGUI(this.currentDragObjects):this.currentDragObjects[0].getSingleObjectDragGUI(),"absolute"!=RicoUtil.getElementsComputedStyle(dragElement,"position")&&(dragElement.style.position="absolute"),(null==dragElement.parentNode||11==dragElement.parentNode.nodeType)&&document.body.appendChild(dragElement),this.dragElement=dragElement,this._updateDraggableLocation(e),this.currentDragObjectVisible=!0}},_updateDraggableLocation:function(e){var dragObjectStyle=this.dragElement.style;dragObjectStyle.left=e.screenX-this.startx+"px",dragObjectStyle.top=e.screenY-this.starty+"px"},_updateDropZonesHover:function(e){for(var n=this.dropZones.length,i=0;n>i;i++)this._mousePointInDropZone(e,this.dropZones[i])||this.dropZones[i].hideHover();for(var i=0;n>i;i++)this._mousePointInDropZone(e,this.dropZones[i])&&this.dropZones[i].canAccept(this.currentDragObjects)&&this.dropZones[i].showHover()},_startDrag:function(e){for(var i=0;i<this.currentDragObjects.length;i++)this.currentDragObjects[i].startDrag();this._makeDraggableObjectVisible(e)},_mouseUpHandler:function(e){if(this.hasSelection()){var nsEvent=void 0!=e.which;if(!(nsEvent&&1!=e.which||!nsEvent&&1!=e.button))return this.interestedInMotionEvents=!1,null==this.dragElement?void this._terminateEvent(e):void(this._placeDraggableInDropZone(e)?this._completeDropOperation(e):(this._terminateEvent(e),new Effect.Position(this.dragElement,this.origPos.x,this.origPos.y,200,20,{complete:this._doCancelDragProcessing.bind(this)})))}},_completeDropOperation:function(e){this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()&&null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this._deactivateRegisteredDropZones(),this._endDrag(),this.clearSelection(),this.dragElement=null,this.currentDragObjectVisible=!1,this._terminateEvent(e)},_doCancelDragProcessing:function(){this._cancelDrag(),this.dragElement!=this.currentDragObjects[0].getMouseDownHTMLElement()&&null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this._deactivateRegisteredDropZones(),this.dragElement=null,this.currentDragObjectVisible=!1},_placeDraggableInDropZone:function(e){for(var foundDropZone=!1,n=this.dropZones.length,i=0;n>i;i++)if(this._mousePointInDropZone(e,this.dropZones[i])&&this.dropZones[i].canAccept(this.currentDragObjects)){this.dropZones[i].hideHover(),this.dropZones[i].accept(this.currentDragObjects),foundDropZone=!0;break}return foundDropZone},_cancelDrag:function(){for(var i=0;i<this.currentDragObjects.length;i++)this.currentDragObjects[i].cancelDrag()},_endDrag:function(){for(var i=0;i<this.currentDragObjects.length;i++)this.currentDragObjects[i].endDrag()},_mousePointInDropZone:function(e,dropZone){var absoluteRect=dropZone.getAbsoluteRect();return e.clientX>absoluteRect.left&&e.clientX<absoluteRect.right&&e.clientY>absoluteRect.top&&e.clientY<absoluteRect.bottom},_addMouseDownHandler:function(aDraggable){var htmlElement=aDraggable.getMouseDownHTMLElement();null!=htmlElement&&(htmlElement.draggable=aDraggable,this._addMouseDownEvent(htmlElement))},_activateRegisteredDropZones:function(){for(var n=this.dropZones.length,i=0;n>i;i++){var dropZone=this.dropZones[i];dropZone.canAccept(this.currentDragObjects)&&dropZone.activate()}this.activatedDropZones=!0},_deactivateRegisteredDropZones:function(){for(var n=this.dropZones.length,i=0;n>i;i++)this.dropZones[i].deactivate();this.activatedDropZones=!1},_addMouseDownEvent:function(htmlElement){"undefined"!=typeof document.implementation&&document.implementation.hasFeature("HTML","1.0")&&document.implementation.hasFeature("Events","2.0")&&document.implementation.hasFeature("CSS","2.0")?htmlElement.addEventListener("mousedown",this._mouseDownHandler.bindAsEventListener(this),!1):htmlElement.attachEvent("onmousedown",this._mouseDownHandler.bindAsEventListener(this))},_terminateEvent:function(e){void 0!=e.stopPropagation?e.stopPropagation():void 0!=e.cancelBubble&&(e.cancelBubble=!0),void 0!=e.preventDefault?e.preventDefault():e.returnValue=!1},initializeEventHandlers:function(){"undefined"!=typeof document.implementation&&document.implementation.hasFeature("HTML","1.0")&&document.implementation.hasFeature("Events","2.0")&&document.implementation.hasFeature("CSS","2.0")?(document.addEventListener("mouseup",this._mouseUpHandler.bindAsEventListener(this),!1),document.addEventListener("mousemove",this._mouseMoveHandler.bindAsEventListener(this),!1)):(document.attachEvent("onmouseup",this._mouseUpHandler.bindAsEventListener(this)),document.attachEvent("onmousemove",this._mouseMoveHandler.bindAsEventListener(this)))}},Rico.Draggable=Class.create(),Rico.Draggable.prototype={initialize:function(type,htmlElement){this.type=type,this.htmlElement=$(htmlElement),this.selected=!1},getMouseDownHTMLElement:function(){return this.htmlElement},select:function(){if(this.selected=!0,!this.showingSelected){var htmlElement=this.getMouseDownHTMLElement(),color=Rico.Color.createColorFromBackground(htmlElement);color.isBright()?color.darken(.033):color.brighten(.033),this.saveBackground=RicoUtil.getElementsComputedStyle(htmlElement,"backgroundColor","background-color"),htmlElement.style.backgroundColor=color.asHex(),this.showingSelected=!0}},deselect:function(){if(this.selected=!1,this.showingSelected){var htmlElement=this.getMouseDownHTMLElement();htmlElement.style.backgroundColor=this.saveBackground,this.showingSelected=!1}},isSelected:function(){return this.selected},startDrag:function(){},cancelDrag:function(){},endDrag:function(){},getSingleObjectDragGUI:function(){return this.htmlElement},getMultiObjectDragGUI:function(){return this.htmlElement},getDroppedGUI:function(){return this.htmlElement},toString:function(){return this.type+":"+this.htmlElement+":"}},Rico.Dropzone=Class.create(),Rico.Dropzone.prototype={initialize:function(htmlElement){this.htmlElement=$(htmlElement),this.absoluteRect=null},getHTMLElement:function(){return this.htmlElement},clearPositionCache:function(){this.absoluteRect=null},getAbsoluteRect:function(){if(null==this.absoluteRect){var htmlElement=this.getHTMLElement(),pos=RicoUtil.toViewportPosition(htmlElement);this.absoluteRect={top:pos.y,left:pos.x,bottom:pos.y+htmlElement.offsetHeight,right:pos.x+htmlElement.offsetWidth}}return this.absoluteRect},activate:function(){var htmlElement=this.getHTMLElement();if(null!=htmlElement&&!this.showingActive){this.showingActive=!0,this.saveBackgroundColor=htmlElement.style.backgroundColor;var fallbackColor="#ffea84",currentColor=Rico.Color.createColorFromBackground(htmlElement);null==currentColor?htmlElement.style.backgroundColor=fallbackColor:(currentColor.isBright()?currentColor.darken(.2):currentColor.brighten(.2),htmlElement.style.backgroundColor=currentColor.asHex())}},deactivate:function(){var htmlElement=this.getHTMLElement();null!=htmlElement&&this.showingActive&&(htmlElement.style.backgroundColor=this.saveBackgroundColor,this.showingActive=!1,this.saveBackgroundColor=null)},showHover:function(){var htmlElement=this.getHTMLElement();null==htmlElement||this.showingHover||(this.saveBorderWidth=htmlElement.style.borderWidth,this.saveBorderStyle=htmlElement.style.borderStyle,this.saveBorderColor=htmlElement.style.borderColor,this.showingHover=!0,htmlElement.style.borderWidth="1px",htmlElement.style.borderStyle="solid",htmlElement.style.borderColor="#ffff00")},hideHover:function(){var htmlElement=this.getHTMLElement();null!=htmlElement&&this.showingHover&&(htmlElement.style.borderWidth=this.saveBorderWidth,htmlElement.style.borderStyle=this.saveBorderStyle,htmlElement.style.borderColor=this.saveBorderColor,this.showingHover=!1)},canAccept:function(){return!0},accept:function(draggableObjects){var htmlElement=this.getHTMLElement();if(null!=htmlElement){n=draggableObjects.length;for(var i=0;n>i;i++){var theGUI=draggableObjects[i].getDroppedGUI();"absolute"==RicoUtil.getElementsComputedStyle(theGUI,"position")&&(theGUI.style.position="static",theGUI.style.top="",theGUI.style.top=""),htmlElement.appendChild(theGUI)}}}},void 0==window.Effect&&(Effect={}),Effect.SizeAndPosition=Class.create(),Effect.SizeAndPosition.prototype={initialize:function(element,x,y,w,h,duration,steps){this.element=$(element),this.x=x,this.y=y,this.w=w,this.h=h,this.duration=duration,this.steps=steps,this.options=arguments[7]||{},this.sizeAndPosition()},sizeAndPosition:function(){if(this.isFinished())return void(this.options.complete&&this.options.complete(this));this.timer&&clearTimeout(this.timer);var stepDuration=Math.round(this.duration/this.steps),currentX=this.element.offsetLeft,currentY=this.element.offsetTop,currentW=this.element.offsetWidth,currentH=this.element.offsetHeight;this.x=this.x?this.x:currentX,this.y=this.y?this.y:currentY,this.w=this.w?this.w:currentW,this.h=this.h?this.h:currentH;var difX=this.steps>0?(this.x-currentX)/this.steps:0,difY=this.steps>0?(this.y-currentY)/this.steps:0,difW=this.steps>0?(this.w-currentW)/this.steps:0,difH=this.steps>0?(this.h-currentH)/this.steps:0;this.moveBy(difX,difY),this.resizeBy(difW,difH),this.duration-=stepDuration,this.steps--,this.timer=setTimeout(this.sizeAndPosition.bind(this),stepDuration)},isFinished:function(){return this.steps<=0},moveBy:function(difX,difY){var currentLeft=this.element.offsetLeft,currentTop=this.element.offsetTop,intDifX=parseInt(difX),intDifY=parseInt(difY),style=this.element.style;0!=intDifX&&(style.left=currentLeft+intDifX+"px"),0!=intDifY&&(style.top=currentTop+intDifY+"px")},resizeBy:function(difW,difH){var currentWidth=this.element.offsetWidth,currentHeight=this.element.offsetHeight,intDifW=parseInt(difW),intDifH=parseInt(difH),style=this.element.style;0!=intDifW&&(style.width=currentWidth+intDifW+"px"),0!=intDifH&&(style.height=currentHeight+intDifH+"px")
}},Effect.Size=Class.create(),Effect.Size.prototype={initialize:function(element,w,h,duration,steps,options){new Effect.SizeAndPosition(element,null,null,w,h,duration,steps,options)}},Effect.Position=Class.create(),Effect.Position.prototype={initialize:function(element,x,y,duration,steps,options){new Effect.SizeAndPosition(element,x,y,null,null,duration,steps,options)}},Effect.Round=Class.create(),Effect.Round.prototype={initialize:function(tagName,className,options){for(var elements=document.getElementsByTagAndClassName(tagName,className),i=0;i<elements.length;i++)Rico.Corner.round(elements[i],options)}},Effect.FadeTo=Class.create(),Effect.FadeTo.prototype={initialize:function(element,opacity,duration,steps){this.element=$(element),this.opacity=opacity,this.duration=duration,this.steps=steps,this.options=arguments[4]||{},this.fadeTo()},fadeTo:function(){if(this.isFinished())return void(this.options.complete&&this.options.complete(this));this.timer&&clearTimeout(this.timer);var stepDuration=Math.round(this.duration/this.steps),currentOpacity=this.getElementOpacity(),delta=this.steps>0?(this.opacity-currentOpacity)/this.steps:0;this.changeOpacityBy(delta),this.duration-=stepDuration,this.steps--,this.timer=setTimeout(this.fadeTo.bind(this),stepDuration)},changeOpacityBy:function(v){var currentOpacity=this.getElementOpacity(),newOpacity=Math.max(0,Math.min(currentOpacity+v,1));this.element.ricoOpacity=newOpacity,this.element.style.filter="alpha(opacity:"+Math.round(100*newOpacity)+")",this.element.style.opacity=newOpacity},isFinished:function(){return this.steps<=0},getElementOpacity:function(){if(void 0==this.element.ricoOpacity){var opacity;if(this.element.currentStyle)opacity=this.element.currentStyle.opacity;else if(void 0!=document.defaultView.getComputedStyle){var computedStyle=document.defaultView.getComputedStyle;opacity=computedStyle(this.element,null).getPropertyValue("opacity")}this.element.ricoOpacity=void 0!=opacity?opacity:1}return parseFloat(this.element.ricoOpacity)}},Effect.AccordionSize=Class.create(),Effect.AccordionSize.prototype={initialize:function(e1,e2,start,end,duration,steps){this.e1=$(e1),this.e2=$(e2),this.start=start,this.end=end,this.duration=duration,this.steps=steps,this.options=arguments[6]||{},this.accordionSize()},accordionSize:function(){if(this.isFinished())return this.e1.style.height=this.start+"px",this.e2.style.height=this.end+"px",void(this.options.complete&&this.options.complete(this));this.timer&&clearTimeout(this.timer);var stepDuration=Math.round(this.duration/this.steps),diff=this.steps>0?(parseInt(this.e1.offsetHeight)-this.start)/this.steps:0;this.resizeBy(diff),this.duration-=stepDuration,this.steps--,this.timer=setTimeout(this.accordionSize.bind(this),stepDuration)},isFinished:function(){return this.steps<=0},resizeBy:function(diff){var h1Height=this.e1.offsetHeight,h2Height=this.e2.offsetHeight,intDiff=parseInt(diff);0!=diff&&(this.e1.style.height=h1Height-intDiff+"px",this.e2.style.height=h2Height+intDiff+"px")}},Rico.LiveGridMetaData=Class.create(),Rico.LiveGridMetaData.prototype={initialize:function(pageSize,totalRows,columnCount,options){this.pageSize=pageSize,this.totalRows=totalRows,this.setOptions(options),this.scrollArrowHeight=16,this.columnCount=columnCount},setOptions:function(options){this.options={largeBufferSize:7,nearLimitFactor:.2}.extend(options||{})},getPageSize:function(){return this.pageSize},getTotalRows:function(){return this.totalRows},setTotalRows:function(n){this.totalRows=n},getLargeBufferSize:function(){return parseInt(this.options.largeBufferSize*this.pageSize)},getLimitTolerance:function(){return parseInt(this.getLargeBufferSize()*this.options.nearLimitFactor)}},Rico.LiveGridScroller=Class.create(),Rico.LiveGridScroller.prototype={initialize:function(liveGrid,viewPort){this.isIE=navigator.userAgent.toLowerCase().indexOf("msie")>=0,this.liveGrid=liveGrid,this.metaData=liveGrid.metaData,this.createScrollBar(),this.scrollTimeout=null,this.lastScrollPos=0,this.viewPort=viewPort,this.rows=new Array},isUnPlugged:function(){return null==this.scrollerDiv.onscroll},plugin:function(){this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this)},unplug:function(){this.scrollerDiv.onscroll=null},sizeIEHeaderHack:function(){if(this.isIE){var headerTable=$(this.liveGrid.tableId+"_header");headerTable&&(headerTable.rows[0].cells[0].style.width=headerTable.rows[0].cells[0].offsetWidth+1+"px")}},createScrollBar:function(){var visibleHeight=this.liveGrid.viewPort.visibleHeight();this.scrollerDiv=document.createElement("div");var scrollerStyle=this.scrollerDiv.style;scrollerStyle.borderRight="1px solid #ababab",scrollerStyle.position="relative",scrollerStyle.left=this.isIE?"-6px":"-3px",scrollerStyle.width="19px",scrollerStyle.height=visibleHeight+"px",scrollerStyle.overflow="auto",this.heightDiv=document.createElement("div"),this.heightDiv.style.width="1px",this.heightDiv.style.height=parseInt(visibleHeight*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px",this.scrollerDiv.appendChild(this.heightDiv),this.scrollerDiv.onscroll=this.handleScroll.bindAsEventListener(this);var table=this.liveGrid.table;table.parentNode.parentNode.insertBefore(this.scrollerDiv,table.parentNode.nextSibling)},updateSize:function(){var visibleHeight=(this.liveGrid.table,this.viewPort.visibleHeight());this.heightDiv.style.height=parseInt(visibleHeight*this.metaData.getTotalRows()/this.metaData.getPageSize())+"px"},rowToPixel:function(rowOffset){return rowOffset/this.metaData.getTotalRows()*this.heightDiv.offsetHeight},moveScroll:function(rowOffset){this.scrollerDiv.scrollTop=this.rowToPixel(rowOffset),this.metaData.options.onscroll&&this.metaData.options.onscroll(this.liveGrid,rowOffset)},handleScroll:function(){this.scrollTimeout&&clearTimeout(this.scrollTimeout);var contentOffset=parseInt(this.scrollerDiv.scrollTop/this.viewPort.rowHeight);this.liveGrid.requestContentRefresh(contentOffset),this.viewPort.scrollTo(this.scrollerDiv.scrollTop),this.metaData.options.onscroll&&this.metaData.options.onscroll(this.liveGrid,contentOffset),this.scrollTimeout=setTimeout(this.scrollIdle.bind(this),1200)},scrollIdle:function(){this.metaData.options.onscrollidle&&this.metaData.options.onscrollidle()}},Rico.LiveGridBuffer=Class.create(),Rico.LiveGridBuffer.prototype={initialize:function(metaData,viewPort){this.startPos=0,this.size=0,this.metaData=metaData,this.rows=new Array,this.updateInProgress=!1,this.viewPort=viewPort,this.maxBufferSize=2*metaData.getLargeBufferSize(),this.maxFetchSize=metaData.getLargeBufferSize(),this.lastOffset=0},getBlankRow:function(){if(!this.blankRow){this.blankRow=new Array;for(var i=0;i<this.metaData.columnCount;i++)this.blankRow[i]="&nbsp;"}return this.blankRow},loadRows:function(ajaxResponse){var rowsElement=ajaxResponse.getElementsByTagName("rows")[0];this.updateUI="true"==rowsElement.getAttribute("update_ui");for(var newRows=new Array,trs=rowsElement.getElementsByTagName("tr"),i=0;i<trs.length;i++)for(var row=newRows[i]=new Array,cells=trs[i].getElementsByTagName("td"),j=0;j<cells.length;j++){var cell=cells[j],convertSpaces="true"==cell.getAttribute("convert_spaces"),cellContent=RicoUtil.getContentAsString(cell);row[j]=convertSpaces?this.convertSpaces(cellContent):cellContent,row[j]||(row[j]="&nbsp;")}return newRows},update:function(ajaxResponse,start){var newRows=this.loadRows(ajaxResponse);if(0==this.rows.length)return this.rows=newRows,this.size=this.rows.length,void(this.startPos=start);if(start>this.startPos){if(this.startPos+this.rows.length<start)this.rows=newRows,this.startPos=start;else if(this.rows=this.rows.concat(newRows.slice(0,newRows.length)),this.rows.length>this.maxBufferSize){var fullSize=this.rows.length;this.rows=this.rows.slice(this.rows.length-this.maxBufferSize,this.rows.length),this.startPos=this.startPos+(fullSize-this.rows.length)}}else start+newRows.length<this.startPos?this.rows=newRows:(this.rows=newRows.slice(0,this.startPos).concat(this.rows),this.rows.length>this.maxBufferSize&&(this.rows=this.rows.slice(0,this.maxBufferSize))),this.startPos=start;this.size=this.rows.length},clear:function(){this.rows=new Array,this.startPos=0,this.size=0},isOverlapping:function(start,size){return start<this.endPos()&&this.startPos<start+size||0==this.endPos()},isInRange:function(position){return position>=this.startPos&&position+this.metaData.getPageSize()<=this.endPos()},isNearingTopLimit:function(position){return position-this.startPos<this.metaData.getLimitTolerance()},endPos:function(){return this.startPos+this.rows.length},isNearingBottomLimit:function(position){return this.endPos()-(position+this.metaData.getPageSize())<this.metaData.getLimitTolerance()},isAtTop:function(){return 0==this.startPos},isAtBottom:function(){return this.endPos()==this.metaData.getTotalRows()},isNearingLimit:function(position){return!this.isAtTop()&&this.isNearingTopLimit(position)||!this.isAtBottom()&&this.isNearingBottomLimit(position)},getFetchSize:function(offset){var adjustedOffset=this.getFetchOffset(offset),adjustedSize=0;if(adjustedOffset>=this.startPos){var endFetchOffset=this.maxFetchSize+adjustedOffset;endFetchOffset>this.metaData.totalRows&&(endFetchOffset=this.metaData.totalRows),adjustedSize=endFetchOffset-adjustedOffset}else{var adjustedSize=this.startPos-adjustedOffset;adjustedSize>this.maxFetchSize&&(adjustedSize=this.maxFetchSize)}return adjustedSize},getFetchOffset:function(offset){var adjustedOffset=offset;if(offset>this.startPos)adjustedOffset=offset>this.endPos()?offset:this.endPos();else if(offset+this.maxFetchSize>=this.startPos){var adjustedOffset=this.startPos-this.maxFetchSize;0>adjustedOffset&&(adjustedOffset=0)}return this.lastOffset=adjustedOffset,adjustedOffset},getRows:function(start,count){var begPos=start-this.startPos,endPos=begPos+count;endPos>this.size&&(endPos=this.size);for(var results=new Array,index=0,i=begPos;endPos>i;i++)results[index++]=this.rows[i];return results},convertSpaces:function(s){return s.split(" ").join("&nbsp;")}},Rico.GridViewPort=Class.create(),Rico.GridViewPort.prototype={initialize:function(table,rowHeight,visibleRows,buffer,liveGrid){this.lastDisplayedStartPos=0,this.div=table.parentNode,this.table=table,this.rowHeight=rowHeight,this.div.style.height=this.rowHeight*visibleRows,this.div.style.overflow="hidden",this.buffer=buffer,this.liveGrid=liveGrid,this.visibleRows=visibleRows+1,this.lastPixelOffset=0,this.startPos=0},populateRow:function(htmlRow,row){for(var j=0;j<row.length;j++)htmlRow.cells[j].innerHTML=row[j]},bufferChanged:function(){this.refreshContents(parseInt(this.lastPixelOffset/this.rowHeight))},clearRows:function(){if(!this.isBlank){for(var i=0;i<this.visibleRows;i++)this.populateRow(this.table.rows[i],this.buffer.getBlankRow());this.isBlank=!0}},clearContents:function(){this.clearRows(),this.scrollTo(0),this.startPos=0,this.lastStartPos=-1},refreshContents:function(startPos){if(startPos!=this.lastRowPos||this.isPartialBlank||this.isBlank){if(startPos+this.visibleRows<this.buffer.startPos||this.buffer.startPos+this.buffer.size<startPos||0==this.buffer.size)return void this.clearRows();this.isBlank=!1;for(var viewPrecedesBuffer=this.buffer.startPos>startPos,contentStartPos=viewPrecedesBuffer?this.buffer.startPos:startPos,contentEndPos=this.buffer.startPos+this.buffer.size<startPos+this.visibleRows?this.buffer.startPos+this.buffer.size:startPos+this.visibleRows,rowSize=contentEndPos-contentStartPos,rows=this.buffer.getRows(contentStartPos,rowSize),blankSize=this.visibleRows-rowSize,blankOffset=viewPrecedesBuffer?0:rowSize,contentOffset=viewPrecedesBuffer?blankSize:0,i=0;i<rows.length;i++)this.populateRow(this.table.rows[i+contentOffset],rows[i]);for(var i=0;blankSize>i;i++)this.populateRow(this.table.rows[i+blankOffset],this.buffer.getBlankRow());this.isPartialBlank=blankSize>0,this.lastRowPos=startPos}},scrollTo:function(pixelOffset){this.lastPixelOffset!=pixelOffset&&(this.refreshContents(parseInt(pixelOffset/this.rowHeight)),this.div.scrollTop=pixelOffset%this.rowHeight,this.lastPixelOffset=pixelOffset)},visibleHeight:function(){return parseInt(this.div.style.height)}},Rico.LiveGridRequest=Class.create(),Rico.LiveGridRequest.prototype={initialize:function(requestOffset){this.requestOffset=requestOffset}},Rico.LiveGrid=Class.create(),Rico.LiveGrid.prototype={initialize:function(tableId,visibleRows,totalRows,url,options){null==options&&(options={}),this.tableId=tableId,this.table=$(tableId);var columnCount=this.table.rows[0].cells.length;this.metaData=new Rico.LiveGridMetaData(visibleRows,totalRows,columnCount,options),this.buffer=new Rico.LiveGridBuffer(this.metaData);var rowCount=this.table.rows.length;if(this.viewPort=new Rico.GridViewPort(this.table,this.table.offsetHeight/rowCount,visibleRows,this.buffer,this),this.scroller=new Rico.LiveGridScroller(this,this.viewPort),this.additionalParms=options.requestParameters||[],options.sortHandler=this.sortHandler.bind(this),$(tableId+"_header")&&(this.sort=new Rico.LiveGridSort(tableId+"_header",options)),this.processingRequest=null,this.unprocessedRequest=null,this.initAjax(url),options.prefetchBuffer||options.prefetchOffset>0){var offset=0;options.offset&&(offset=options.offset,this.scroller.moveScroll(offset),this.viewPort.scrollTo(this.scroller.rowToPixel(offset))),options.sortCol&&(this.sortCol=options.sortCol,this.sortDir=options.sortDir),this.requestContentRefresh(offset)}},resetContents:function(){this.scroller.moveScroll(0),this.buffer.clear(),this.viewPort.clearContents()},sortHandler:function(column){this.sortCol=column.name,this.sortDir=column.currentSort,this.resetContents(),this.requestContentRefresh(0)},setRequestParams:function(){this.additionalParms=[];for(var i=0;i<arguments.length;i++)this.additionalParms[i]=arguments[i]},setTotalRows:function(newTotalRows){this.resetContents(),this.metaData.setTotalRows(newTotalRows),this.scroller.updateSize()},initAjax:function(url){ajaxEngine.registerRequest(this.tableId+"_request",url),ajaxEngine.registerAjaxObject(this.tableId+"_updater",this)},invokeAjax:function(){},handleTimedOut:function(){this.processingRequest=null,this.processQueuedRequest()},fetchBuffer:function(offset){if(!this.buffer.isInRange(offset)||this.buffer.isNearingLimit(offset)){if(this.processingRequest)return void(this.unprocessedRequest=new Rico.LiveGridRequest(offset));var bufferStartPos=this.buffer.getFetchOffset(offset);this.processingRequest=new Rico.LiveGridRequest(offset),this.processingRequest.bufferOffset=bufferStartPos;var fetchSize=this.buffer.getFetchSize(offset),callParms=[];callParms.push(this.tableId+"_request"),callParms.push("id="+this.tableId),callParms.push("page_size="+fetchSize),callParms.push("offset="+bufferStartPos),this.sortCol&&(callParms.push("sort_col="+this.sortCol),callParms.push("sort_dir="+this.sortDir));for(var i=0;i<this.additionalParms.length;i++)callParms.push(this.additionalParms[i]);ajaxEngine.sendRequest.apply(ajaxEngine,callParms),this.timeoutHandler=setTimeout(this.handleTimedOut.bind(this),2e4)}},requestContentRefresh:function(contentOffset){this.fetchBuffer(contentOffset)},ajaxUpdate:function(ajaxResponse){try{clearTimeout(this.timeoutHandler),this.buffer.update(ajaxResponse,this.processingRequest.bufferOffset),this.viewPort.bufferChanged()}catch(err){}finally{this.processingRequest=null}this.processQueuedRequest()},processQueuedRequest:function(){null!=this.unprocessedRequest&&(this.requestContentRefresh(this.unprocessedRequest.requestOffset),this.unprocessedRequest=null)}},Rico.LiveGridSort=Class.create(),Rico.LiveGridSort.prototype={initialize:function(headerTableId,options){this.headerTableId=headerTableId,this.headerTable=$(headerTableId),this.setOptions(options),this.applySortBehavior(),this.options.sortCol&&this.setSortUI(this.options.sortCol,this.options.sortDir)},setSortUI:function(columnName,sortDirection){for(var cols=this.options.columns,i=0;i<cols.length;i++)if(cols[i].name==columnName){this.setColumnSort(i,sortDirection);break}},setOptions:function(options){this.options={sortAscendImg:"images/sort_asc.gif",sortDescendImg:"images/sort_desc.gif",imageWidth:9,imageHeight:5,ajaxSortURLParms:[]}.extend(options),(new Image).src=this.options.sortAscendImg,(new Image).src=this.options.sortDescendImg,this.sort=options.sortHandler,this.options.columns=this.options.columns?this.convertToTableColumns(this.options.columns):this.introspectForColumnInfo()},applySortBehavior:function(){for(var headerRow=this.headerTable.rows[0],headerCells=headerRow.cells,i=0;i<headerCells.length;i++)this.addSortBehaviorToColumn(i,headerCells[i])},addSortBehaviorToColumn:function(n,cell){this.options.columns[n].isSortable()&&(cell.id=this.headerTableId+"_"+n,cell.style.cursor="pointer",cell.onclick=this.headerCellClicked.bindAsEventListener(this),cell.innerHTML=cell.innerHTML+'<span id="'+this.headerTableId+"_img_"+n+'">&nbsp;&nbsp;&nbsp;</span>')},headerCellClicked:function(evt){var eventTarget=evt.target?evt.target:evt.srcElement,cellId=eventTarget.id,columnNumber=parseInt(cellId.substring(cellId.lastIndexOf("_")+1)),sortedColumnIndex=this.getSortedColumnIndex();-1!=sortedColumnIndex?sortedColumnIndex!=columnNumber?(this.removeColumnSort(sortedColumnIndex),this.setColumnSort(columnNumber,Rico.TableColumn.SORT_ASC)):this.toggleColumnSort(sortedColumnIndex):this.setColumnSort(columnNumber,Rico.TableColumn.SORT_ASC),this.options.sortHandler&&this.options.sortHandler(this.options.columns[columnNumber])},removeColumnSort:function(n){this.options.columns[n].setUnsorted(),this.setSortImage(n)},setColumnSort:function(n,direction){this.options.columns[n].setSorted(direction),this.setSortImage(n)},toggleColumnSort:function(n){this.options.columns[n].toggleSort(),this.setSortImage(n)},setSortImage:function(n){var sortDirection=this.options.columns[n].getSortDirection(),sortImageSpan=$(this.headerTableId+"_img_"+n);sortDirection==Rico.TableColumn.UNSORTED?sortImageSpan.innerHTML="&nbsp;&nbsp;":sortDirection==Rico.TableColumn.SORT_ASC?sortImageSpan.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" height="'+this.options.imageHeight+'" src="'+this.options.sortAscendImg+'"/>':sortDirection==Rico.TableColumn.SORT_DESC&&(sortImageSpan.innerHTML='&nbsp;&nbsp;<img width="'+this.options.imageWidth+'" height="'+this.options.imageHeight+'" src="'+this.options.sortDescendImg+'"/>')},getSortedColumnIndex:function(){for(var cols=this.options.columns,i=0;i<cols.length;i++)if(cols[i].isSorted())return i;return-1},introspectForColumnInfo:function(){for(var columns=new Array,headerRow=this.headerTable.rows[0],headerCells=headerRow.cells,i=0;i<headerCells.length;i++)columns.push(new Rico.TableColumn(this.deriveColumnNameFromCell(headerCells[i],i),!0));return columns},convertToTableColumns:function(cols){for(var columns=new Array,i=0;i<cols.length;i++)columns.push(new Rico.TableColumn(cols[i][0],cols[i][1]))},deriveColumnNameFromCell:function(cell,columnNumber){var cellContent=void 0!=cell.innerText?cell.innerText:cell.textContent;return cellContent?cellContent.toLowerCase().split(" ").join("_"):"col_"+columnNumber}},Rico.TableColumn=Class.create(),Rico.TableColumn.UNSORTED=0,Rico.TableColumn.SORT_ASC="ASC",Rico.TableColumn.SORT_DESC="DESC",Rico.TableColumn.prototype={initialize:function(name,sortable){this.name=name,this.sortable=sortable,this.currentSort=Rico.TableColumn.UNSORTED},isSortable:function(){return this.sortable},isSorted:function(){return this.currentSort!=Rico.TableColumn.UNSORTED},getSortDirection:function(){return this.currentSort},toggleSort:function(){this.currentSort==Rico.TableColumn.UNSORTED||this.currentSort==Rico.TableColumn.SORT_DESC?this.currentSort=Rico.TableColumn.SORT_ASC:this.currentSort==Rico.TableColumn.SORT_ASC&&(this.currentSort=Rico.TableColumn.SORT_DESC)},setUnsorted:function(){this.setSorted(Rico.TableColumn.UNSORTED)},setSorted:function(direction){this.currentSort=direction}};var RicoUtil={getElementsComputedStyle:function(htmlElement,cssProperty,mozillaEquivalentCSS){2==arguments.length&&(mozillaEquivalentCSS=cssProperty);var el=$(htmlElement);return el.currentStyle?el.currentStyle[cssProperty]:document.defaultView.getComputedStyle(el,null).getPropertyValue(mozillaEquivalentCSS)},createXmlDocument:function(){if(document.implementation&&document.implementation.createDocument){var doc=document.implementation.createDocument("","",null);return null==doc.readyState&&(doc.readyState=1,doc.addEventListener("load",function(){doc.readyState=4,"function"==typeof doc.onreadystatechange&&doc.onreadystatechange()},!1)),doc}return window.ActiveXObject?Try.these(function(){return new ActiveXObject("MSXML2.DomDocument")},function(){return new ActiveXObject("Microsoft.DomDocument")},function(){return new ActiveXObject("MSXML.DomDocument")},function(){return new ActiveXObject("MSXML3.DomDocument")})||!1:null},getContentAsString:function(parentNode){return void 0!=parentNode.xml?this._getContentAsStringIE(parentNode):this._getContentAsStringMozilla(parentNode)},_getContentAsStringIE:function(parentNode){for(var contentStr="",i=0;i<parentNode.childNodes.length;i++)contentStr+=parentNode.childNodes[i].xml;return contentStr},_getContentAsStringMozilla:function(parentNode){for(var xmlSerializer=new XMLSerializer,contentStr="",i=0;i<parentNode.childNodes.length;i++)contentStr+=xmlSerializer.serializeToString(parentNode.childNodes[i]);return contentStr},toViewportPosition:function(element){return this._toAbsolute(element,!0)},toDocumentPosition:function(element){return this._toAbsolute(element,!1)},_toAbsolute:function(element,accountForDocScroll){if(-1==navigator.userAgent.toLowerCase().indexOf("msie"))return this._toAbsoluteMozilla(element,accountForDocScroll);for(var x=0,y=0,parent=element;parent;){var borderXOffset=0,borderYOffset=0;if(parent!=element){var borderXOffset=parseInt(this.getElementsComputedStyle(parent,"borderLeftWidth")),borderYOffset=parseInt(this.getElementsComputedStyle(parent,"borderTopWidth"));borderXOffset=isNaN(borderXOffset)?0:borderXOffset,borderYOffset=isNaN(borderYOffset)?0:borderYOffset}x+=parent.offsetLeft-parent.scrollLeft+borderXOffset,y+=parent.offsetTop-parent.scrollTop+borderYOffset,parent=parent.offsetParent}return accountForDocScroll&&(x-=this.docScrollLeft(),y-=this.docScrollTop()),{x:x,y:y}},_toAbsoluteMozilla:function(element,accountForDocScroll){for(var x=0,y=0,parent=element;parent;)x+=parent.offsetLeft,y+=parent.offsetTop,parent=parent.offsetParent;for(parent=element;parent&&parent!=document.body&&parent!=document.documentElement;)parent.scrollLeft&&(x-=parent.scrollLeft),parent.scrollTop&&(y-=parent.scrollTop),parent=parent.parentNode;return accountForDocScroll&&(x-=this.docScrollLeft(),y-=this.docScrollTop()),{x:x,y:y}},docScrollLeft:function(){return window.pageXOffset?window.pageXOffset:document.documentElement&&document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body?document.body.scrollLeft:0},docScrollTop:function(){return window.pageYOffset?window.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body?document.body.scrollTop:0}};